<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Test firebase storage</title>
		<style>

			body {
				display: flex;
				min-height: 100vh;
				width: 100%;
				padding: 0;
				margin: 0;
				align-items: center;
				justify-content: center;
				flex-direction: column;
			}

			#uploader {
				width: 50%;
				margin-bottom: 10px;
			}

			#img-thumbnail {
				width: 30%;
				height: auto;
				padding-bottom: 10px;
			}

		</style>
	</head>
	<body>
		<h1>Hello world</h1>

		<img id="img-thumbnail" src="http://ubmttq.hatinh.gov.vn/ubmttq/static/images/img_defautl.jpg">

		<progress value="0" max="100" id="uploader">0%</progress>

		<input type="file" value="upload" id="fileBtn">

		<script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>

		<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyDIyIvl_tpVZ5cyqQ-2Qz6idvhKTil4HLQ",
			authDomain: "android-pushnotification-24c95.firebaseapp.com",
			databaseURL: "https://android-pushnotification-24c95.firebaseio.com",
			projectId: "android-pushnotification-24c95",
			storageBucket: "android-pushnotification-24c95.appspot.com",
			messagingSenderId: "81391745260"
		};
		firebase.initializeApp(config);

		// Get elements in DOM
		const uploader = document.getElementById('uploader');
		const fileBtn = document.getElementById('fileBtn');

		// Listen for file selection
		fileBtn.addEventListener('change', (e) => {
			// Get file
			const file = e.target.files[0];

			// Create a store ref
			const storageRef = firebase.storage().ref(`images/${file.name}`);

			// Upload file
			let task = storageRef.put(file);

			// Upload progress bar
			task.on(
				'state_changed',

				// Upload progress
				snapshot => {
					let percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;
					uploader.value = percentage;
				},

				// Possible error
				error => {
					alert('Có lỗi xảy ra. Vui lòng thử lại');
				},

				// Complete
				() => {
					task.snapshot.ref.getDownloadURL().then(downloadURL => {
						alert(`File available at ${downloadURL}`);
						document.getElementById('img-thumbnail').src = downloadURL;
					});
				}
			)
		});

		</script>
	</body>
</html>